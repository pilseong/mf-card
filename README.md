# MiFare Classic 1K 리더기 구현

## 배경
* 예약을 관리하고, 해당 예약에 대해 pincode를 발급하는 기능은 웹과 모바일앱으로 구현되어 있다. 다만 카드키를 발급할 때는 별도의 윈도우 프로그램을 설치하여 사용하고 있다.
* 이런 환경에서 하나의 플렛폼 독립적인 프로그램으로 예약관리, pincode 발급, 카드키까지 발급할 수 있는 프로그램의 요구가 있다.
  * 예약정보의 생성과 접근은 이미 운영중인 웹프로그램으로 실행
  * 핀코드 발급, 취소 역시 해당 웹프로그램으로 실행
  * 카드키 발급은 관리 PC에 USB로 부착된 NFC Reader를 통해서 실행
* 이런 요구사항을 충족하는 프로그램은 Electron으로 구현하기 위한 리서치 프로젝트이다. (3일 정도만에 정리한 것이라 내용이 많지가 않다.)
  * Electron은 설치된 PC의 하드웨어를 접근할 수 있다. 윈도우의 경우는 기본적으로 표준에 맞는 NFC 드라이버가 설치되어 있다. 리눅스와 맥의 경우도 간단하게 해당 드라이버 설치가 가능하다.
  * 예약정보 접근과 카드키 발급은 Electron에 포함된 V8엔진으로 가능하다. 하드웨어 접근과 웹페이지 사이의 중재 API를 통해서 상호 통신이 가능

## 사용 라이브러리
* 하드웨어를 제어하는 드라이버에 접근하려면 해당 드라이버와 NodeJs를 연결해주는 connector가 필요하다. 
* 이 부분을 위해서 C++ addon을 구현하는 것이 필요하지만 실제 이 기능을 구현한  pokusew/node-pcsclite라는 라이브러리가 존재한다. 그리고 이 라이브러리를 NodeJs용으로 사용하는 pokusew/nfc-pcsc 라이브러리가 있기 때문에 구현할 부분이 많지는 않다.
  * 물론 추후에 이 라이브러리가 Node 버전에 따라 기능을 제공하지 못하면 직접 구현할 필요가 있다. 참고할 소스가 있다는 것은 내부적으로 구현해서 사용할 때 참조할 수 있어 좋다.

## 설치
* 윈도우의 경우는 별도로 pcscd 서비스를 설치할 필요가 없다. 
* 노드 버전에 따른 nfc-pscs 라이브러리 compile이 필요하다. 
* 노드 18버전가지 동작확인
```
  npm install
  npm run rebuild
  npm start
```
* 리눅스의 경우 

```
  apt-get install libpcsclite1 libpcsclite-dev
  apt-get install pcscd
  sudo systemctl start pcscd
  npm install
  npm run rebuild 
  npm start
```

* 소스를 보면 웹페이지에 대한 부분이 주석처리 된 것을 볼 수 있다. 이 프로젝트는 단순히 electron 상에서 웹과 하드웨어 드라이버를 같이 사용할 수 있는 것에 대한 검증이기 때문에 그 부분에만 충실했다.